<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Razberry Z-Wave controller</title>
</head>

<body>

<h1>Razberry</h1>
<p>As described before, the LamPI system was designed for- and initially worked only for 433MHz based devices. Over the last months, devices based on the Z-Wave system working on 868MHz (Europe) have dropped in price and are beginning to become an alternative to these cheaper 433MHz switches and dimmers. As the communication between Z-Wave omponents is more reliable, all Z-Wave devices have a transmitter on board and can report their current status back to the server, I decided to look for a way to integrate the 868 MHz system into my LamPI environment.</p>
<p>Also, Z-Wave networks make a mesh network with means that every Z-Wave device acts as a bridge to other Z-Wave devices. This extends the network in a flexible way as devices that are located further away from your controller devices will use intermediate Z-Wave devices to receive and transmit messages through the network to the controller.</p>
<h2>Architecture</h2>
<p>The architecture we are going to use for LamPI is as follows: A dedicated Raspberry PI with Razberry controller will be included in the LamPI system and this controller will only handle Z-Wave devices, sensors plugs etc. In principle it is quite good possible to use the Raspberry/Z-Wave combo for other work as well, even for controlling 433MHz devices, as the Razberry board uses only the first 6 or 8 pins on the Raspberry P1 connector. </p>
<h2>Hardware Installation</h2>
<p>Plug the Razberry Z-Wave board on the P1 connector of the Raspberry device. Make sure that the pins are aligned at the right side of both connectors. You're done.</p>
<h2>Software Installation</h2>
<p>Login on your Raspberry over a terminal interface and iInstall the Razberry package with he following command.</p>
<ol>
  <li>sudo apt-get update</li>
  <li>sudo apt-get upgrade</li>
  <li>wget -q -O - http://razberry.z-wave.me/install | sudo bash</li>
</ol>
<p>Probably best to reboot the device now with 'sudo reboot'.</p>
<h2>Run the basic User interface</h2>
<p>Start the basic User interface in the browser. http://192.168.1.xx:8083 where 192.168.1.xx is the IP address of the raspberry on your network. If you do not know the IP address of your Razberry, run the following command from a command terminal:</p>
<p>&gt; sudo ifconfig</p>
<p> and look for the IP address under the eth0 or wlan0 section of the output.</p>
<p>When the User interface is atrted, select the good old expert GUI and select then the &quot;network&quot; tab.</p>
<h2>Use the URL Interface for LamPI</h2>
<p>The Zwave webinterface shield a lot of details from the user. However, this interface is still rather complex and therefore the solution would be to shield all the command-line -like details from the user. As of release 1.5 the Razberry software contains support for OpenRemote throuh a URL (JSon) interface.</p>
<p>&nbsp;</p>
<p><code>http://192.168.2.102:8083/ZAutomation/OpenRemote/SwitchMultilevelSet/2/0/30</code></p>
<p>The webserver will return &quot;30&quot; (including the quotes!)</p>
<p>This will set my Fibaro dimmer with device number 2 (and service index 0)  to 30% luminance. As you can see this is hardly an interface for novice or even somewhat advanced users.</p>
<p>On the z-wave.me website the following commands are specified (copy). OpenRemote API was introduced in version Z-Way 1.5.0 controller. To control devices there are several HTTP commands:<br>
  <br>
  <a href="http://IP:8083/ZAutomation/OpenRemote/Command/N/I/param">http://IP:8083/ZAutomation/OpenRemote/Command/N/I/param</a><br>
  IP - Address of the controller RaZberry<br>
  Command - &#1057;ontrol command<br>
  N - device Number of Z-Wave<br>
  I  - Inside a device can be physically multiple devices (channels), for  example 2 relay or temperature sensor, motion sensor, light sensor. The  Instance parameter is a channel number within the device. If a device  has only one physical device, this option is 0.<br>
  param - Parameter, which is used with some teams, for example to set the dimmer 50%<br>
  <br>
  Teams (commands):<br>
  1) SwitchBinaryOn/N/I - Enables device<br>
  2) SwitchBinaryOff/N/I - Off device<br>
  3) SwitchBinaryStatus/N/I - Show on or off the device (on/off)<br>
  4) SwitchMultilevelSet/N/I/param - Open the blinds or dimming light level, param - dimming level, for example 50<br>
  5) SwitchMultilevelLevel/N/I - Show the percentage of open blinds or &#1087;&#1088;&#1086;&#1076;&#1080;&#1084;&#1084;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085; light<br>
  6) SwitchMultilevelStatus/N/I - Show dimmer on/off, blinds open/closed<br>
  7) AlarmStatus/N - Show whether the alarm ,"on" alarm means<br>
  8)  SensorBinaryStatus/N/I/Type - Show for determining whether a binary  sensor (opening movement, leakage), "on" means work. Type - the Type of  sensor is usually equal to 1<br>
  9) ThermostatLevel/N - Show temperature which must support thermostat<br>
  10) ThermostatSet/N/param - Set temperature, which must support a thermostat, param - temperature<br>
  11)  ThermostatSetMode/N/Mode - Set the thermostat mode Off, Heat, Cool,  Auto, Auxiliary, Resume, Fan Only, Furnace, Dry Air, Moist Air, Auto  Change Over, Heat Energy Save, Save Energy Save Cool, Heat Away, Away,  Cool, Full Power, Manufacturer Specific, Low Auto, On Low, Auto, High,  On High, Auto Medium, On Medium<br>
  12) ThermostatModeName/N - Show the name of the regime, which is now set<br>
  13) BatteryLevel/N - Show charge batteries<br>
  14) MeterLevel/N/I/S - Show electricity consumption. S=0 for kWh; S=2 Watts<br>
  15) MeterReset/N/I - read Zero power consumption<br>
  16) TemperatureLevel/N/I - Show temperature<br>
  17) HumidityLevel/N/I - Show humidity<br>
  18) SensorMultilevel/N/I/S Is indication of the sensor S - conditional number of the sensor in the Z-Way<br>
  19) DoorLock/N - Close castle<br>
20) DoorUnlock/N - Open the lock</p>
<p>&nbsp;</p>
<h2>Notifications/Callbacks</h2>
<p>The web interface described above comes in very handy if we want to get or set the status of a perticular device. However, it does not allow us to receive a status update of one of the connected devices. For example, if the user would use a wall switch to switch a lamp, the LamPI software would not know this. Of course we can check the status of a LamPI every now and then but this requires more compute power as we normally want.</p>
<p>&nbsp;</p>
<h2>Links and Documentation</h2>
<p>I copied some documents from the Z-Wave.me website for no other reason than mae them easy to find and keep versions used for LamPI available even if on-line documentation would change.</p>
<ul>
  <li>http://www.openremote.org/display/docs/OpenRemote+2.0+How+To+-+Z-Wave+with+Razberry</li>
  <li><a href="quick-start-guide-v2.pdf">Razberry quick-start-guide v2</a></li>
  <li><a href="RaZberryOnePager.pdf">Razberry One pager</a></li>
  <li><a href="zwayUse.pdf">Razberry User Manual</a></li>
  <li><a href="zwayDev.pdf">Razberry Developer Manual</a></li>
</ul>
<p>&nbsp;</p>
<p>&nbsp;</p>
</body>
</html>
